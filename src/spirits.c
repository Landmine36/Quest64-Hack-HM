#include "../include/Quest64.h"

SpiritData MelrodeTownSpirits[] = {
    {332.5625f, 703.015625f, 0},
};

SpiritData MonasteryChapelSpirits[] = {
    {0, -20, 119},
};

SpiritData OutsideMonasterySpirits[] = {
    {1124.90625f, 826.046875f, 1},
};

SpiritData DondoranCastleTownSpirits[] = {
    {178.5f, -16.0f, 2},
	{-272.843139648f, -186.879333496f, 116},
};

SpiritData HolyPlainSpirits[] = {
{-334.9609375f, 188.00390625f, 3},
{-1624.3125f, -1021.796875f, 4},
{140.485626221f, -856.56817627f, 115},
};

SpiritData DondoranFlatsSpirits[] = {
{-591.578125f, 717.953125f, 5},
{32.1201171875f, -596.8125f, 6},
{578.609375f, -1487.34375f, 7},
{360.2900085449219f, -1151.7899169921875f, 98},
};

SpiritData LarapoolSpirits[] = {
{331.927886963f, -44.8247070312, 118},
};

SpiritData DrainedLowerLarapoolSpirits[] = {
{161.60546875f, -234.77734375f, 8},
{695.40625f, 249.75390625f, 9},
{695.40625f, 200.59375f, 10},
};

SpiritData WestCarmaghSpirits[] = {
{1310.59375f, 9.317138671875f, 11},
{-917.21875f, 647.703125f, 12},
{369.40625f, -1383.125f, 13},
{153.864440918f, 659.537353516f, 117},
};

SpiritData NormoonSpirits[] = {
{17.92138671875f, 78.017578125f, 14},
{166.53515625f, 190.3125f, 15},
{167.01953125f, 11.485107421875f, 16},
};

SpiritData EastLimelinSpirits[] = {
{1087.5f, -359.625f, 17},
{-2287.0f, 195.1875f, 18},
{-1064.0f, 220.0f, 19},
{1429.815673828125f, -1760.29345703125f, 20},
};

SpiritData LimelinCastleTownSpirits[] = {
{-853.59375f, 547.25f, 21},
{-506.3984375f, -406.2265625f, 22},
{223.39453125f, -538.375f, 23},
{311.6640625f, -342.265625f, 24},
};

SpiritData LimelinCastleFrontSpirits[] = {
{40.6953125f, 478.265625f, 25},
};

SpiritData DindomDriesSpirits[] = {
{-128.86328125f, 1253.84375f, 26},
{264.421875f, 631.203125f, 27},
{-761.09375f, 32.0f, 28},
{-1920.0f, 1152.0f, 29},
{1286.0f, 1197.78125f, 30},
{-1984.0f, -352.0f, 31},
};

SpiritData ShamwoodSpirits[] = {
{-120.0f, 312.0f, 32},
{4.4747314453125f, -1203.59375f, 33},
};

SpiritData ShamwoodUnkSpirits[] = {
{-42.86328125f, -46.5f, 34},
{42.599609375f, -46.5f, 35},
};

SpiritData BrannochCastleFrontSpirits[] = {
{-1864.0f, 416.0f, 36},
};

SpiritData BrannochMoorSpirits[] = {
{864.0f, -128.0f, 37},
{-127.5f, -54.3076171875f, 38},
{-446.0f, -294.0f, 39},
{-588.0f, 213.6484375f, 40},
};

SpiritData IsleOfSkyeSpirits[] = {
{502.0f, 108.90625f, 41},
{447.625f, -191.43359375f, 42},
{864.546875f, 614.625f, 43},
{847.921875f, 440.7578125f, 44},
};

SpiritData BlueCaveSpirits[] = {
{2188.125f, 4870.0f, 45},
{2160.375f, 5488.625f, 46},
{2023.5f, 5285.0f, 47},
{1662.8125f, 5486.875f, 48},
{1317.34375f, 5516.375f, 49},
{1699.96875f, 6448.0f, 50},
};

SpiritData BlueCaveBuildingAreaSpirits[] = {
    {85.458984375f, -129.73828125f, 51},
};

SpiritData CullHazardSpirits[] = {
{3237.5625f, 4815.375f, 52},
{3198.125f, 5597.5f, 53},
};

SpiritData BaragoonTunnelSpirits[] = {
{-6103.625f, 96.939453125f, 54},
{-144.61328125f, 654.953125f, 55},
{2678.5625f, 1878.5625f, 56},
{4105.25f, 1904.09375f, 57},
{4574.25f, 1882.46875f, 58},
};

SpiritData BoilHoleSpirits[] = {
{1527.15625f, -376.0859375f, 59},
{4782.75f, 973.421875f, 60},
};

SpiritData SecretRoomSpirits[] = {
{113.8359375f, 121.6015625f, 61},
};

SpiritData PrinceLeonardoArrivedSpirits[] = {
{76.3984375f, -92.337890625f, 62},
};

SpiritData ConnorFortressSpirits[] = {
{374.59375f, -176.9609375f, 67},
{426.140625f, -558.546875f, 64},
{2352.4375f, -370.40625f, 65},
{-587.515625f, -71.69140625f, 66},
};

SpiritData FortressBuildingSpirits[] = {
    {0.0f, 0.0f, 63},
};

SpiritData GlencoeForestSpirits[] = {
{473.765625f, -225.1953125f, 68},
{-100.521484375f, -183.3359375f, 69},
{-398.96875f, 459.0390625f, 70},
{-803.359375f, -842.828125f, 71},
{-1504.0f, -362.5625f, 72},
{-1672.03125f, 206.26953125f, 73},
};

SpiritData WindwardForestSpirits[] = {
{110.40625f, -200.421875f, 74},
{185.65625f, 293.1328125f, 75},
{857.59375f, 447.7421875f, 76},
};

SpiritData CabinSpirits[] = {
{29.5185546875f, -18.15185546875f, 77},
};

SpiritData SecretRoomSecretSpirits[] = {
{128.0f, -4.656612873077393e-10f, 78},
};

SpiritData KingsSecretRoomSpirits[] = {
{-11.3125f, 68.0f, 79},
};

SpiritData MarionsSpirits[] = {
{-32.75f, 27.23876953125f, 80},
};

SpiritData LimelinCastleEntranceSpirits[] = {
{0.6983642578125f, 52.0f, 81},
{116.49609375f, 24.4658203125f, 82},
};

SpiritData LibrarySpirits[] = {
{24.5f, 54.25f, 83},
};

SpiritData JailRoomSpirits[] = {
{-8.607421875f, -48.75f, 84},
};

SpiritData MineCabinSpirits[] = {
{-35.4345703125f, 14.45458984375f, 85},
{35.2890625f, -13.199951171875f, 86},
};

SpiritData DesertTentSpirits[] = {
{-27.46044921875f, 28.59326171875f, 87},
};

SpiritData UpstairsSpirits[] = {
{-49.1484375f, 8.1298828125f, 88},
};

SpiritData LavaarsTreasureChamberSpirits[] = {
{0.0f, 88.0f, 89},
{0.0f, 88.0f, 90},
{0.0f, 88.0f, 91},
{0.0f, 88.0f, 92},
};

SpiritData TreasureTombJackpotSpirits[] = {
{-25.75f, 61.75f, 93},
{25.75f, 61.75f, 94},
};

SpiritData SkyePortalSpirits[] = {
{-34.5f, 24.5f, 95},
};

SpiritData MacrensShipRoomSpirits[] = {
{15.369873046875f, -26.39990234375f, 96},
};

SpiritData InsideDondoranShip[] = {
    {0.0f, 38.0f, 97},
};

SpiritData InsideLimelinShip[] = {
    {0.0f, 38.0f, 97},
};

SpiritData InsideCarmaghShip[] = {
    {0.0f, 38.0f, 97},
};

SpiritData MammonsWorld1[] ={
	{-100.052902222f, -141.363433838 , 99},
};

SpiritData MammonsWorld2[] ={
	{-318.600006104, -0.182745784521 , 100},
};

SpiritData MammonsWorld3[] ={
	{-483.984649658, 224.920379639 , 101},
};

SpiritData MammonsWorld4[] ={
	{-18.9926319122, -39.6027107239 , 102},
};

SpiritData MammonsWorld5[] ={
	{-1.85025382042, 394.054138184 , 103},
};

SpiritData MammonsWorld6[] ={
	{82.8815383911, 375.881469727 , 104},
};

SpiritData MammonsWorld7[] ={
	{8.18927097321, 37.0745010376 , 105},
};

SpiritData MammonsWorld8[] ={
	{-29.0524520874, -253.830047607 , 106},
};

SpiritData MammonsWorld9[] ={
	{345.416351318, 171.628234863 , 107},
};

SpiritData MammonsWorld10[] ={
	{0, -15.8999996185 , 108},
};

SpiritData MammonsWorld11[] ={
	{-487.271484375, -476.01953125 , 109},
};

SpiritData MammonsWorld12[] ={
	{-19.3999996185, 0 , 110},
};

SpiritData MammonsWorld13[] ={
	{50, 601.738098145 , 111},
	{-190.446411133, -500 , 112},
};

SpiritData MammonsWorld14[] ={
	{1163.01672363, 754.214355469 , 113},
};

SpiritData MammonsWorld15[] ={
	{-25.9002380371, -356.905639648 , 114},
};
SpiritData ClairesHouse[] ={
	{11.3686495, -105.356514 , 120},
};

SpiritTable newSpiritTable[] = {
    //mapID, submap, spiritCount, pad, spiritLocations
    {0, 0,  ARRAY_COUNT(MelrodeTownSpirits),            MelrodeTownSpirits},
    {0, 1,  ARRAY_COUNT(OutsideMonasterySpirits),       OutsideMonasterySpirits},
	{0xD, 8,  ARRAY_COUNT(MonasteryChapelSpirits),       MonasteryChapelSpirits},
    {1, 0,  ARRAY_COUNT(DondoranCastleTownSpirits),     DondoranCastleTownSpirits},
    {2, 0,  ARRAY_COUNT(HolyPlainSpirits),              HolyPlainSpirits},
    {3, 0,  ARRAY_COUNT(DondoranFlatsSpirits),          DondoranFlatsSpirits},
	{4, 0,  ARRAY_COUNT(LarapoolSpirits),   LarapoolSpirits},
    {4, 2,  ARRAY_COUNT(DrainedLowerLarapoolSpirits),   DrainedLowerLarapoolSpirits},
    {5, 0,  ARRAY_COUNT(WestCarmaghSpirits),            WestCarmaghSpirits},
    {6, 0,  ARRAY_COUNT(NormoonSpirits),                NormoonSpirits},
    {7, 0,  ARRAY_COUNT(EastLimelinSpirits),            EastLimelinSpirits},
    {8, 0,  ARRAY_COUNT(LimelinCastleTownSpirits),      LimelinCastleTownSpirits},
    {8, 1,  ARRAY_COUNT(LimelinCastleFrontSpirits),     LimelinCastleFrontSpirits},
    {9, 0,  ARRAY_COUNT(DindomDriesSpirits),            DindomDriesSpirits},
    {0xA, 0, ARRAY_COUNT(ShamwoodSpirits),              ShamwoodSpirits},
    {0xA, 1, ARRAY_COUNT(ShamwoodUnkSpirits),           ShamwoodUnkSpirits},
    {0xB, 1, ARRAY_COUNT(BrannochCastleFrontSpirits),   BrannochCastleFrontSpirits},
    {0xB, 2, ARRAY_COUNT(BrannochMoorSpirits),          BrannochMoorSpirits},
    {0xC, 0, ARRAY_COUNT(IsleOfSkyeSpirits),            IsleOfSkyeSpirits},
    {0x1A, 0, ARRAY_COUNT(BlueCaveSpirits),             BlueCaveSpirits},
    {0x1A, 2, ARRAY_COUNT(BlueCaveBuildingAreaSpirits), BlueCaveBuildingAreaSpirits},
    {0x1B, 0, ARRAY_COUNT(CullHazardSpirits),           CullHazardSpirits},
    {0x1C, 0, ARRAY_COUNT(BaragoonTunnelSpirits),       BaragoonTunnelSpirits},
    {0x1D, 0, ARRAY_COUNT(BoilHoleSpirits),             BoilHoleSpirits},
    {0x1E, 8, ARRAY_COUNT(SecretRoomSpirits),           SecretRoomSpirits},
    {0x1E, 0xF, ARRAY_COUNT(PrinceLeonardoArrivedSpirits), PrinceLeonardoArrivedSpirits},
    {0x1F, 0, ARRAY_COUNT(ConnorFortressSpirits),       ConnorFortressSpirits},
    {0x1F, 2, ARRAY_COUNT(FortressBuildingSpirits),     FortressBuildingSpirits},
    {0x20, 0, ARRAY_COUNT(GlencoeForestSpirits),        GlencoeForestSpirits},
    {0x21, 0, ARRAY_COUNT(WindwardForestSpirits),       WindwardForestSpirits},
    {0x21, 1, ARRAY_COUNT(CabinSpirits),                CabinSpirits},
    {0xE, 0xF, ARRAY_COUNT(SecretRoomSecretSpirits),    SecretRoomSecretSpirits},
    {0xE, 0xC, ARRAY_COUNT(KingsSecretRoomSpirits),     KingsSecretRoomSpirits},
    {0x10, 0x15, ARRAY_COUNT(MarionsSpirits),           MarionsSpirits},
    {0x15, 0, ARRAY_COUNT(LimelinCastleEntranceSpirits), LimelinCastleEntranceSpirits},
    {0x15, 6, ARRAY_COUNT(LibrarySpirits),              LibrarySpirits},
    {0x16, 1, ARRAY_COUNT(JailRoomSpirits),             JailRoomSpirits},
    {0x16, 0x17, ARRAY_COUNT(MineCabinSpirits),         MineCabinSpirits},
    {0x17, 0x13, ARRAY_COUNT(DesertTentSpirits),        DesertTentSpirits},
    {0x17, 0x17, ARRAY_COUNT(UpstairsSpirits),          UpstairsSpirits},
    {0x18, 0, ARRAY_COUNT(LavaarsTreasureChamberSpirits), LavaarsTreasureChamberSpirits},
    {0x18, 2, ARRAY_COUNT(TreasureTombJackpotSpirits),  TreasureTombJackpotSpirits},
    {0x19, 1, ARRAY_COUNT(SkyePortalSpirits),           SkyePortalSpirits},
    {0x19, 4, ARRAY_COUNT(MacrensShipRoomSpirits),      MacrensShipRoomSpirits},
    {0x19, 9, ARRAY_COUNT(InsideDondoranShip),          InsideDondoranShip},
	{0x19, 8, ARRAY_COUNT(InsideLimelinShip),          InsideLimelinShip},
	{0x19, 5, ARRAY_COUNT(InsideCarmaghShip),          InsideCarmaghShip},
	{0x0, 2, ARRAY_COUNT(MammonsWorld1),          MammonsWorld1},
	{0x22, 0, ARRAY_COUNT(MammonsWorld2),          MammonsWorld2},
	{0x22, 6, ARRAY_COUNT(MammonsWorld3),          MammonsWorld3},
	{0xE, 0xD, ARRAY_COUNT(MammonsWorld4),          MammonsWorld4},
	{0x22, 7, ARRAY_COUNT(MammonsWorld5),          MammonsWorld5},
	{0x22, 4, ARRAY_COUNT(MammonsWorld6),          MammonsWorld6},
	{0x16, 0x19, ARRAY_COUNT(MammonsWorld7),          MammonsWorld7},
	{0x22, 2, ARRAY_COUNT(MammonsWorld8),          MammonsWorld8},
	{0x22, 5, ARRAY_COUNT(MammonsWorld9),          MammonsWorld9},
	{0x19, 7, ARRAY_COUNT(MammonsWorld10),          MammonsWorld10},
	{0x22, 9, ARRAY_COUNT(MammonsWorld11),          MammonsWorld11},
	{0xf, 0xD, ARRAY_COUNT(MammonsWorld12),          MammonsWorld12},
	{0x0, 3, ARRAY_COUNT(MammonsWorld13),          MammonsWorld13},
	{0x0, 4, ARRAY_COUNT(MammonsWorld14),          MammonsWorld14},
	{0x22, 8, ARRAY_COUNT(MammonsWorld15),          MammonsWorld15},
	{0x10, 1, ARRAY_COUNT(ClairesHouse),	ClairesHouse},
};

void func_80012220_Hook(void) {
    s32 spiritCount;
    unkStructOriginal* var_s0;
    SpiritData* spiritData;
    s32 i;

    for (i = 0; i < ARRAY_COUNT(newSpiritTable); i++) {
        if ((gCurrentMap != newSpiritTable[i].map) || (gNextSubmap != newSpiritTable[i].subMap)) {
            continue;
        } else {
            break;
        }
    }
    
    if (i < ARRAY_COUNT(newSpiritTable)) {
        spiritCount = newSpiritTable[i].spiritCount;
        spiritData = newSpiritTable[i].spiritData;
        var_s0 = D_80086A08;
        D_80086A00 = spiritCount;
        for (; spiritCount != 0; spiritCount--) {
            var_s0->unk_12 = -1;
            var_s0->unk_10 = func_80012700(spiritData->id);
            var_s0->pos.x = spiritData->xPos;
            var_s0->pos.z = -spiritData->zPos;
            func_8000EE60(var_s0->pos.x, 0.0f, var_s0->pos.z, 0xA00, &D_80086AC8);
            var_s0->pos.y = D_80086AC8.y;
            var_s0->unk_0C = 0.0f;
            var_s0->spiritID = spiritData->id;
            spiritData++;
            var_s0++;          
        }
    } else {
        D_80086A00 = 0;
    }
}